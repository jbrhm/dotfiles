---
- name: Install Config Packages
  hosts: localhost

  tasks:
  - name: Install APT Packages
    become: true
    ansible.builtin.apt:
      name:
        - nodejs
        - npm
        - unzip
        - stow
        - tmux
        - terminator
        - ripgrep
        - xsel
        - xclip
        - i3
        - zsh
        - fzf
      state: latest

  - name: Install Snap Packages
    become: true
    community.general.snap:
      name: nvim
      classic: true

  - name: Install TPM
    ansible.builtin.git:
      repo: 'https://github.com/tmux-plugins/tpm'
      dest: '~/.tmux/plugins/tpm'

  - name: Oh-My-Zsh
    git:
      repo: https://github.com/ohmyzsh/ohmyzsh.git
      dest: ~/.oh-my-zsh
      version: master

  - name: ZSH Automatic Suggestions Plugin
    git:
      repo: https://github.com/zsh-users/zsh-autosuggestions
      dest: ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions

  - name: ZSH Syntax Highlighting Plugin
    git:
      repo: https://github.com/zsh-users/zsh-syntax-highlighting
      dest: ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting

  - name: Use ZSH as a default shell
    become: true
    command: chsh --shell /usr/bin/zsh john

  - name: GitHub CLI APT Key
    become: True
    apt_key:
      url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
      keyring: /usr/share/keyrings/githubcli-archive-keyring.gpg

  - name: GitHub APT List
    become: True
    apt_repository:
      repo: deb [signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main
      filename: github-cli

  - name: Add VSCode APT Key
    become: true
    apt_key:
      url: https://packages.microsoft.com/keys/microsoft.asc
      keyring: /usr/share/keyrings/packages.microsoft.gpg

  - name: Add VSCode APT List
    become: true
    apt_repository:
      filename: vscode
      repo: "deb [arch=amd64,arm64,armhf signed-by=/usr/share/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main"

  - name: Install APT Packages
    become: true
    apt:
      cache_valid_time: 604800
      state: latest
      name:
        - gh
        - code

  - name: Synchronize Udev Rules
    synchronize:
      src: ../files/rules/
      dest: /etc/udev/rules.d
      recursive: true

  - name: Reload Rules
    become: true
    command: udevadm control --reload-rules

  - name: Udev Trigger
    become: true
    command: udevadm trigger --subsystem-match=tty
